{% extends "layout.html" %}
{% block content %}
<div id="post_box">
    <form method="post" action="/post/newPost">
        <input type="text" id="search_text" placeholder="제목/작가를 입력하세요">
        <button onclick="searchBook()">search</button>
        <div id="result_list">
        </div>
        <textarea name="post_title" id="" cols="30" rows="10" maxlength="40"></textarea>
        <textarea name="post_free_text" id="" cols="30" rows="10" maxlength="200"></textarea>
    </form> 
</div>
{% endblock %}

{% block script %}
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        const socket= io.connect('http://localhost:8080/post', { path: '/socket.io'});

        function searchBook() {
            const text= document.getElementById('search_text').value;
            alert(text);
            axios.post('/post/search', { text });
        }

        socket.on('searchBooks', function (data) {
            
            const result_list_div= document.getElementById('result_list');
            while ( result_list_div.hasChildNodes() ) { result_list_div.removeChild( result_list_div.firstChild ); }
            const data_js= JSON.parse(data);
            alert(data_js.root.result.item[0].title_info._cdata);
            data_js.root.result.item.forEach(item=> {
                    const div= document.createElement('div');
                    const img= document.createElement('img');
                    const h1_1= document.createElement('h1');
                    const h1_2= document.createElement('h1');
                    const h1_3= document.createElement('h1');
                    const h1_4= document.createElement('h1');

                    h1_3.style.display= 'none';
                    h1_4.style.display= 'none';

                    img.src= "https://cover.nl.go.kr/kolis/" + item.pub_year_info._text + "/" + item.control_no._text +  "_thumbnail.jpg";
                    h1_1.textContent= item.title_info._cdata;
                    h1_2.textContent= item.author_info._cdata;
                    h1_3.textContent= item.kdc_code_1s.cdata;
                    h1_4.textContent= item.isbn._cdata;
                    div.appendChild(img);
                    div.appendChild(h1_1);
                    div.appendChild(h1_2);
                    div.appendChild(h1_3);
                    div.appendChild(h1_4);
                    div.onClick= selectBook(item.isbn);
                    result_list_div.appendChild(div);
            });
        })
        
        function selectBook(isbn) {
            axios.post('/book/admin', { isbn });
        }

    </script>
{% endblock %}