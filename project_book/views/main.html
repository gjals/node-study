{% extends 'layout.html' %}
{% block content %}
    <div>
        {% for post in posts %}
        <div>
            <img src="{{post.Book.title_url}}" style="width: 50px; height: 50px;">
            {{ post.title }}
            {{ post.Book.title }}
            {{ post.Book.author }}
            {{ post.User.nick }}
            {{ post.free_text}}
        </div>
        {% endfor %}
    </div>
    <a href="/post">포스트 올리기</a>
    <form id="post_genre_form" action="/post/genre" method="post">
        <label><input type="checkbox" name="genre" value="0">총류</label>
        <label><input type="checkbox" name="genre" value="1">철학</label>
        <label><input type="checkbox" name="genre" value="2">종교</label>
        <label><input type="checkbox" name="genre" value="3">사회과학</label>
        <label><input type="checkbox" name="genre" value="4">순수과학</label>
        <label><input type="checkbox" name="genre" value="5">기술과학</label>
        <label><input type="checkbox" name="genre" value="6">예술</label>
        <label><input type="checkbox" name="genre" value="7">언어</label>
        <label><input type="checkbox" name="genre" value="">문학</label>
        <label><input type="checkbox" name="genre" value="9">역사</label>
        <button type="submit">submit</button>
    </form>

    <form id="post_search_form" action="/post/search" method="post">
        <input type="text" name="search_text" placeholder="제목/작가/유저닉네임">
        <button type="submit">submit</button>
    </form>
{% endblock %}

{% block script %}
    <script>
        if (document.getElementById('post-image')) {
            document.getElementById('post-image').addEventListener('change', function(e) { 
                const formData= new FormData(); //Don't forget the enctype="multipart/form-data" in your form.
                console.log(this, this.files);
                formData.append('img', this.files[0]);  //upload.single('img'),  It is important that you use the name field value from the form in your upload function.
                axios.post('/post/img', formData)
                    .then((res) => {
                        document.getElementById('post-image-preview').src= res.data.url; //post하면 res.json({url:'--'})로 데이터 넣어주니 그걸 갖다 씀
                        document.getElementById('post-image-url').value= res.data.url;
                        document.getElementById('post-image-preview').style.display= 'inline';
                    }).catch((err)=>{ console.error(err); });
            });
        }
        //왜 자기 자신이 아닌지 다시 체크하지? 나중에 지워보자!
        document.querySelectorAll('.post-auth-follow').forEach((auth)=>{
            auth.addEventListener('click', ()=>{
                const myid= document.querySelector('#my-id');
                if(myid) {
                    const userid= auth.parentNode.querySelector('#post-auth-id').value;
                    if(userid!==myid.vaule) {
                        if(confirm('ㄹㅇ할꺼임?')) { //확인, 취소 두 버튼이 뜨고 true, false를 돌려줌 
                            axios.post(`/user/${userid}/follow`).then(()=>{location.reload();}).catch((err)=>{console.err(err)});
                        }
                    }
                }
            })
        })
    
        document.querySelectorAll('#post-good').forEach((postgood)=>{
            postgood.addEventListener('click', ()=>{
                const myid= document.querySelector('#my-id').value;
                    const postid= postgood.parentNode.querySelector('#post-id').textContent;
                    axios.post(`/user/good`, { postid,id:myid })
                        .then((res)=>{
                            location.reload(true);
                        })
                        .catch((err)=>{console.err(err)});
            })
        })

        // document.querySelector('#post_search_form').addEventListener('submit', function (e) {

        // })
    </script>
{% endblock %} 